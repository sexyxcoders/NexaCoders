<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nexa Coders â€“ AI Feedback</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Segoe UI, sans-serif;
  background: radial-gradient(circle at top, #0b1228, #000);
  color: #fff;
}
.container {
  max-width: 650px;
  margin: auto;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #00f7ff;
  text-shadow: 0 0 20px #00f7ff;
}
.box {
  background: rgba(10, 20, 45, 0.9);
  border: 1px solid #00f7ff44;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
}
input, textarea {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  background: #050a18;
  border: 1px solid #00f7ff55;
  border-radius: 8px;
  color: #fff;
}
button {
  width: 100%;
  padding: 12px;
  margin-top: 12px;
  background: linear-gradient(90deg, #00f7ff, #00ff9c);
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
}
.feedback {
  border-bottom: 1px solid #00f7ff33;
  padding: 10px 0;
}
.reply {
  color: #00ff9c;
  font-size: 14px;
  margin-top: 5px;
}
.admin-btn {
  background: transparent;
  border: 1px solid #00f7ff;
  color: #00f7ff;
}
</style>
</head>

<body>
<div class="container">
<h1>Nexa Coders</h1>

<div class="box">
<h3>Send Feedback</h3>
<input id="name" placeholder="Your Name">
<textarea id="message" placeholder="Your Feedback"></textarea>
<button onclick="sendFeedback()">Submit</button>
</div>

<div class="box">
<button class="admin-btn" onclick="adminLogin()">Admin Login</button>
</div>

<div class="box">
<h3>Feedback & Replies</h3>
<div id="feedbacks"></div>
</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”´ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ðŸ” ADMIN PASSWORD */
const ADMIN_PASSWORD = "nexa@admin";
let isAdmin = false;

/* ðŸ”” TELEGRAM CONFIG */
const TELEGRAM_BOT_TOKEN = "YOUR_TELEGRAM_BOT_TOKEN";
const TELEGRAM_CHAT_ID = "YOUR_CHAT_ID";

/* ðŸ¤– OPENAI CONFIG */
const OPENAI_API_KEY = "YOUR_OPENAI_API_KEY";

function adminLogin() {
  const pass = prompt("Admin Password");
  if (pass === ADMIN_PASSWORD) {
    isAdmin = true;
    alert("Admin Mode Enabled");
    loadFeedbacks();
  } else {
    alert("Wrong password");
  }
}

async function sendFeedback() {
  const name = document.getElementById("name").value.trim();
  const message = document.getElementById("message").value.trim();
  if (!name || !message) return alert("Fill all fields");

  const doc = await db.collection("feedbacks").add({
    name,
    message,
    reply: "",
    time: Date.now()
  });

  sendTelegram(name, message);
  generateAIReply(doc.id, message);

  document.getElementById("message").value = "";
}

/* ðŸ”” TELEGRAM NOTIFICATION */
function sendTelegram(name, message) {
  const text = `ðŸ†• New Feedback\n\nðŸ‘¤ ${name}\nðŸ’¬ ${message}`;
  fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      chat_id: TELEGRAM_CHAT_ID,
      text
    })
  });
}

/* ðŸ¤– AI AUTO REPLY */
async function generateAIReply(id, userMessage) {
  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + OPENAI_API_KEY
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [
        { role: "system", content: "You are Nexa Coders support. Be friendly and professional." },
        { role: "user", content: userMessage }
      ]
    })
  });

  const data = await res.json();
  const reply = data.choices?.[0]?.message?.content || "";

  if (reply) {
    db.collection("feedbacks").doc(id).update({ reply });
  }
}

/* âœï¸ MANUAL ADMIN REPLY */
function manualReply(id) {
  const reply = prompt("Type reply");
  if (reply) db.collection("feedbacks").doc(id).update({ reply });
}

function loadFeedbacks() {
  db.collection("feedbacks")
    .orderBy("time", "desc")
    .onSnapshot(snap => {
      const div = document.getElementById("feedbacks");
      div.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        div.innerHTML += `
          <div class="feedback">
            <b>${d.name}</b><br>
            ${d.message}
            ${d.reply ? `<div class="reply">Reply: ${d.reply}</div>` : ""}
            ${isAdmin ? `<button onclick="manualReply('${doc.id}')">Reply</button>` : ""}
          </div>
        `;
      });
    });
}

loadFeedbacks();
</script>
</body>
</html>